{% extends 'store/base.html' %}
{% load static %}

{% block title %}Cart - Gujarat Crafts{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Shopping Cart</h1>
    </div>

    {% if cart_items %}
        <div class="cart-container">
            <div class="cart-items">
                {% for item in cart_items %}
                    <div class="cart-item">
                        <div class="cart-item-image">
                            {% if item.product.images.first %}
                                <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.name }}">
                            {% else %}
                                <img src="https://via.placeholder.com/150x150?text=No+Image" alt="{{ item.product.name }}">
                            {% endif %}
                        </div>
                        <div class="cart-item-details">
                            <h3><a href="{% url 'product_detail' item.product.id %}">{{ item.product.name }}</a></h3>
                            <p class="cart-item-price">₹{{ item.product.price }} each</p>
                            <div class="cart-item-quantity">
                                <form method="POST" action="{% url 'update_cart' item.id %}" class="quantity-form">
                                    {% csrf_token %}
                                    <label for="quantity-{{ item.id }}">Quantity:</label>
                                    <input type="number" id="quantity-{{ item.id }}" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.quantity }}">
                                    <button type="submit" class="btn btn-sm btn-primary">Update</button>
                                </form>
                            </div>
                            <p class="cart-item-total">Total: ₹{{ item.get_total_price }}</p>
                        </div>
                        <div class="cart-item-actions">
                            <a href="{% url 'remove_from_cart' item.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to remove this item?')">
                                <i class="fas fa-trash"></i> Remove
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="cart-summary">
                <h2>Order Summary</h2>
                <div class="summary-item">
                    <span>Subtotal:</span>
                    <span>₹{{ total_amount }}</span>
                </div>
                <div class="summary-item">
                    <span>Shipping:</span>
                    <span>Free</span>
                </div>
                <div class="summary-item total">
                    <span>Total:</span>
                    <span>₹{{ total_amount }}</span>
                </div>
                <a href="{% url 'buy_now' %}" class="btn btn-primary btn-large btn-block">Proceed to Buy</a>
            </div>
        </div>
    {% else %}
        <div class="empty-cart">
            <i class="fas fa-shopping-cart"></i>
            <h2>Your cart is empty</h2>
            <p>Start adding products to your cart!</p>
            <a href="{% url 'home' %}" class="btn btn-primary">Continue Shopping</a>
        </div>
    {% endif %}
</div>
{% endblock %}

